name: Deploy Data Factory

on:
  push:
permissions:
    id-token: write
    contents: read
jobs:
  deploy:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Azure PowerShell
      uses: azure/setup-powershell@v1
      with:
        az-version: 'latest'

    - name: Run PowerShell script
      id: deploy
      run: |
        $ErrorActionPreference = "Stop"

        # Define parameters
        $DataFactoryName = ${{ secrets.DATA_FACTORY_NAME }}
        $DataFactoryResourceGroup = ${{ secrets.DATA_FACTORY_RESOURCE_GROUP }}
        $DataFactorySubscriptionId = ${{ secrets.DATA_FACTORY_SUBSCRIPTION_ID }}
        $DisableAllTriggers = ${{ secrets.DISABLE_ALL_TRIGGERS }}
        $EnabledTriggers = ${{ secrets.ENABLED_TRIGGERS }}

        # Add other required secrets here...

        # Rest of the PowerShell script (assuming the script is in the root directory)
        .\your_script.ps1 -DataFactoryName $DataFactoryName `
                           -DataFactoryResourceGroup $DataFactoryResourceGroup `
                           -DataFactorySubscriptionId $DataFactorySubscriptionId `
                           -DisableAllTriggers $DisableAllTriggers `
                           -EnabledTriggers $EnabledTriggers

    - name: Display script output
      run: |
        echo "${{ steps.deploy.outputs.stdout }}"
        echo "${{ steps.deploy.outputs.stderr }}"
